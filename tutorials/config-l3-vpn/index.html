<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Configure Layer 3 VPN |</title><meta name=description content="The VPN feature enables routing of IP packets by utilizing a virtual IP space that is configured on the nodes. In this configuration, the node can be used as the next hop for route destined for the virtual IP space, or the node can be used as the default gateway for a network. The virtual IP space is used as a transit network with NAT being utilized to translate IP addresses on to/from the virtual IP space on either side."><meta property="og:title" content="Configure Layer 3 VPN"><meta property="og:description" content="The VPN feature enables routing of IP packets by utilizing a virtual IP space that is configured on the nodes. In this configuration, the node can be used as the next hop for route destined for the virtual IP space, or the node can be used as the default gateway for a network. The virtual IP space is used as a transit network with NAT being utilized to translate IP addresses on to/from the virtual IP space on either side."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.trustgrid.io/tutorials/config-l3-vpn/"><meta property="article:section" content="tutorials"><meta property="article:modified_time" content="2023-02-22T09:42:31+13:00"><meta itemprop=name content="Configure Layer 3 VPN"><meta itemprop=description content="The VPN feature enables routing of IP packets by utilizing a virtual IP space that is configured on the nodes. In this configuration, the node can be used as the next hop for route destined for the virtual IP space, or the node can be used as the default gateway for a network. The virtual IP space is used as a transit network with NAT being utilized to translate IP addresses on to/from the virtual IP space on either side."><meta itemprop=dateModified content="2023-02-22T09:42:31+13:00"><meta itemprop=wordCount content="992"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Configure Layer 3 VPN"><meta name=twitter:description content="The VPN feature enables routing of IP packets by utilizing a virtual IP space that is configured on the nodes. In this configuration, the node can be used as the next hop for route destined for the virtual IP space, or the node can be used as the default gateway for a network. The virtual IP space is used as a transit network with NAT being utilized to translate IP addresses on to/from the virtual IP space on either side."><link rel=preload href=/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css as=style><link href=/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99793053-3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-99793053-3")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 469 106"><defs><style>.cls-1{fill:#6b6b6b}.cls-2{fill:#226ce0}</style></defs><title>Trustgrid-Logo-Grey</title><path class="cls-1" d="M.35 28.58H29.26V-.33H.35zM7.13 6.45H22.47V21.8H7.13z"/><path class="cls-1" d="M67.82-.33H38.9V28.58H67.82zM61 21.8H45.68V6.45H61z"/><path class="cls-1" d="M.35 67.13H29.26V38.22H.35zM7.13 45H22.47V60.35H7.13z"/><path class="cls-1" d="M106.36 38.22H77.45v12.3H67.82V41.27L85.26 23.83l-3.06-3L64.76 38.22H38.9V67.13H67.82V54.83h9.63v12.3h12.3V80.39h4.31V67.13h12.3zM61 60.35H45.68V45H61zm38.55.0H84.23V45H99.58z"/><path class="cls-1" d="M.35 105.69H29.26V76.77H.35zM7.13 83.55H22.47V98.9H7.13z"/><path class="cls-1" d="M38.9 105.69H67.82V76.77H38.9zm6.78-22.14H61V98.9H45.68z"/><path class="cls-2" d="M153.94 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22H140V38.78h13.2v5.78H140V67q0 3.59 1.31 5.13a4.8 4.8.0 003.91 1.55 13.59 13.59.0 006.67-2z"/><path class="cls-2" d="M176.74 39.56A18 18 0 01186 37.07V44.4q-6.58-.24-10.66 3.42a14.51 14.51.0 00-4.64 9.85V80.39h-7.57V37.32h7.57V46.6a15.52 15.52.0 016-7"/><path class="cls-2" d="M232.34 37.32V80.39h-7.65V71.27q-4.23 9.2-16 9.36-7.48.0-11.72-4.44t-4.24-12.25V37.32h7.66V61.9q0 5.46 3 8.51a10.87 10.87.0 008.18 3.06 12.11 12.11.0 009.57-4.28 16 16 0 003.54-10.7V37.32z"/><path class="cls-2" d="M260.47 44.24a21.21 21.21.0 00-6.15-1 10.48 10.48.0 00-5.49 1.26 4.21 4.21.0 00-2.08 3.87 4.3 4.3.0 002.32 4 34.68 34.68.0 007 2.73 54.86 54.86.0 017.33 2.6 13 13 0 014.85 3.83 10.51 10.51.0 012 6.67 10.58 10.58.0 01-4.6 9.29 19.65 19.65.0 01-11.44 3.17 28.35 28.35.0 01-9.32-1.55 21.07 21.07.0 01-7.61-4.39l2.85-5.54a20.07 20.07.0 006.63 3.91 22 22 0 007.69 1.47 11.45 11.45.0 006-1.39 4.61 4.61.0 002.28-4.23 4.82 4.82.0 00-2.4-4.4 32.85 32.85.0 00-7.29-2.93 48.4 48.4.0 01-7-2.48 12.43 12.43.0 01-4.64-3.71A10 10 0 01239.5 49q0-6 4.4-9a19.07 19.07.0 0111-3 27.13 27.13.0 017.69 1.1 23 23 0 016.56 3l-2.77 5.78a26 26 0 00-5.9-2.6"/><path class="cls-2" d="M303.42 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22h7.65V38.78h13.19v5.78H289.49V67c0 2.39.44 4.1 1.3 5.13a4.81 4.81.0 003.91 1.55 13.62 13.62.0 006.68-2z"/><path class="cls-1" d="M352.92 36.34V76.48a19.18 19.18.0 01-3 10.71 19.61 19.61.0 01-8.43 7.08A29.79 29.79.0 01329 96.75a36.74 36.74.0 01-10.66-1.54 34 34 0 01-9-4.16l5.05-10a25.68 25.68.0 006.51 3.17 22.5 22.5.0 007.08 1.14 12.11 12.11.0 007.74-2.27 7.52 7.52.0 002.85-6.2V72.16Q334.12 77.95 326 78a17.69 17.69.0 01-16.41-10.14 24.71 24.71.0 01-2.4-11.12 24.42 24.42.0 012.32-10.91A17.35 17.35.0 01316 38.46a17.92 17.92.0 019.61-2.61A17.42 17.42.0 01333 37.36a14.36 14.36.0 015.5 4.35V36.34zM336.07 64.51a11 11 0 002.44-7.41 11.16 11.16.0 00-2.44-7.49 8.69 8.69.0 00-12.91.0 11 11 0 00-2.48 7.45 10.85 10.85.0 002.48 7.41 8.18 8.18.0 006.47 2.85 8.08 8.08.0 006.44-2.85"/><path class="cls-1" d="M383.9 37.8a16.63 16.63.0 018.26-2V49c-.49.0-1.22-.08-2.2-.08a13.4 13.4.0 00-8.3 2.4A9.18 9.18.0 00378 57.92V80.39H363.5v-44H378v7.33a16 16 0 015.9-5.87"/><path class="cls-1" d="M411.09 18.22a7.55 7.55.0 012.16 5.58 7.59 7.59.0 01-2.16 5.54 8 8 0 01-11 0 7.59 7.59.0 01-2.16-5.54 7.55 7.55.0 012.16-5.58 8.1 8.1.0 0111 0M398.51 36.34h14.41V80.39H398.51z"/><path class="cls-1" d="M468.45 20V80.39H454v-5.7a14.92 14.92.0 01-5.58 4.68A16.94 16.94.0 01440.93 81a20.15 20.15.0 01-10.75-2.85 19.16 19.16.0 01-7.2-8 26.51 26.51.0 01-2.57-11.93 25.77 25.77.0 012.53-11.72A18.6 18.6.0 01430 38.62a20.05 20.05.0 0110.59-2.77 17.24 17.24.0 017.61 1.63A16.19 16.19.0 01454 42.12V20zm-17.1 46.5A11.77 11.77.0 00454 58.57a11.76 11.76.0 00-2.61-8 8.58 8.58.0 00-6.84-3 8.67 8.67.0 00-6.88 3.05A11.69 11.69.0 00435 58.57a11.68 11.68.0 002.64 7.93 8.68 8.68.0 006.88 3.06 8.53 8.53.0 006.84-3.06"/><path class="cls-2" d="M99.58 21.8H84.23V6.46H99.58zM106.36-.33H77.45V28.59h28.91z"/><path class="cls-2" d="M99.58 98.9H84.23V83.55H99.58zm6.78-22.13H77.45v28.92h28.91z"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/getting-started/><span>Getting Started</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/tutorials/><span class=active>Guides</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/help-center/><span>Help Center</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/release-notes/><span>Release Notes</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.7ce67e9837df4078aae35dd1673584b3.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.7ce67e9837df4078aae35dd1673584b3.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><a href=/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-tutorials><span>Guides</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsoperations-runbook-li><a href=/tutorials/operations-runbook/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsoperations-runbook><span>Operations Runbook</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbookcluster-failover-response-li><a href=/tutorials/operations-runbook/cluster-failover-response/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcluster-failover-response><span>Cluster Failover Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbookcontrol-plane-disconnect-li><a href=/tutorials/operations-runbook/control-plane-disconnect/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcontrol-plane-disconnect><span>Control Plane Disconnect</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbooknode-down-response-li><a href=/tutorials/operations-runbook/node-down-response/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooknode-down-response><span>Node Down Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbooksite-failover-li><a href=/tutorials/operations-runbook/site-failover/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooksite-failover><span>Site Failover</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsapplying-changes-li><a href=/tutorials/applying-changes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsapplying-changes><span>Applying Changes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialswan-interface-ip-li><a href=/tutorials/wan-interface-ip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialswan-interface-ip><span>Changing the WAN Interface IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsftp-and-ftps-li><a href=/tutorials/ftp-and-ftps/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsftp-and-ftps><span>Configure FTP and FTPS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-tutorialsconfig-l3-vpn-li><a href=/tutorials/config-l3-vpn/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsconfig-l3-vpn><span class=td-sidebar-nav-active-item>Configure Layer 3 VPN</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsconfigure-wg-edge-node-li><a href=/tutorials/configure-wg-edge-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsconfigure-wg-edge-node><span>Configure WireGuard on an Edge Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsdeployments-li><a href=/tutorials/deployments/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeployments><span>Deployments</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsaws-ha-cluster-li><a href=/tutorials/deployments/aws-ha-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-cluster><span>AWS Requirements for HA Wireguard Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster-li><a href=/tutorials/deployments/aws-ha-ztna-gateway-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster><span>AWS Requirements for HA ZTNA Gateway Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws-li><a href=/tutorials/deployments/configure-ha-gateway-cluster-in-aws/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws><span>Configure HA Trustgrid Gateway Cluster in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsdeploy-aws-ami-li><a href=/tutorials/deployments/deploy-aws-ami/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-aws-ami><span>Deploy a Trustgrid Node AMI in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsdeploy-azure-li><a href=/tutorials/deployments/deploy-azure/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-azure><span>Deploy to Azure</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsdeploy-vsphere-li><a href=/tutorials/deployments/deploy-vsphere/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-vsphere><span>Deploy to vSphere</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsros-config-li><a href=/tutorials/deployments/ros-config/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsros-config><span>On a Stick Configuration</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssaml-okta-li><a href=/tutorials/saml-okta/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssaml-okta><span>Enable SAML with Okta</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsfind-ip-node-li><a href=/tutorials/find-ip-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsfind-ip-node><span>Find the IP Adress of a Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsgateway-tools-li><a href=/tutorials/gateway-tools/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsgateway-tools><span>Gateway Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers-li><a href=/tutorials/gateway-tools/monitoring-network-hops-to-peers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers><span>Monitoring Network Hops to Peers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsping-remote-node-li><a href=/tutorials/gateway-tools/ping-remote-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsping-remote-node><span>Ping Remote Node</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslimit-node-functionality-li><a href=/tutorials/limit-node-functionality/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslimit-node-functionality><span>Limit Node Functionality to Current Public IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsreboot-node-li><a href=/tutorials/reboot-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsreboot-node><span>Reboot a Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsremote-tools-li><a href=/tutorials/remote-tools/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsremote-tools><span>Remote Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsping-remote-virtual-host-li><a href=/tutorials/remote-tools/ping-remote-virtual-host/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsping-remote-virtual-host><span>Ping Remote Virtual Host</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolssniff-interface-traffic-li><a href=/tutorials/remote-tools/sniff-interface-traffic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolssniff-interface-traffic><span>Sniff Interface Traffic</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolstcp-port-test-li><a href=/tutorials/remote-tools/tcp-port-test/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolstcp-port-test><span>TCP Port Test</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsview-virtual-route-table-li><a href=/tutorials/remote-tools/view-virtual-route-table/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsview-virtual-route-table><span>View Virtual Route Table</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsrestart-node-li><a href=/tutorials/restart-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsrestart-node><span>Restart the Trustgrid Service on a Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslocal-console-utility-li><a href=/tutorials/local-console-utility/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utility><span>Trustgrid Local Console Utility</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslocal-node-ip-li><a href=/tutorials/local-node-ip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-node-ip><span>Trustgrid Local UI for Node IP Reconfiguration</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/trustgrid/docs/tree/main/content/en/tutorials/config-l3-vpn/index.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/trustgrid/docs/edit/main/content/en/tutorials/config-l3-vpn/index.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/trustgrid/docs/new/main/content/en/tutorials/config-l3-vpn/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/trustgrid/docs/issues/new?title=Configure%20Layer%203%20VPN" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a id=print href=https://docs.trustgrid.io/tutorials/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://docs.trustgrid.io/tutorials/>Guides</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://docs.trustgrid.io/tutorials/config-l3-vpn/ aria-disabled=true class="btn-link disabled">Configure Layer 3 VPN</a></li></ol></nav><div class=td-content><h1>Configure Layer 3 VPN</h1><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 5 minute read &nbsp;</p></header><p>The VPN feature enables routing of IP packets by utilizing a virtual IP space that is configured on the nodes. In this configuration, the node can be used as the next hop for route destined for the virtual IP space, or the node can be used as the default gateway for a network. The virtual IP space is used as a transit network with NAT being utilized to translate IP addresses on to/from the virtual IP space on either side. It is also possible to preserve the original source and destination by having the virtual IP space be identical to the LAN network.</p><p>The Trustgrid VPN feature provides the capability to securely route IP packets between remote networks. In this configuration, Trustgrid nodes can operate as a distributed mesh virtual private network (VPN) that can allow applications to access remote data and services at layer 3 (L3) of the network OSI model. This is done by defining a virtual L3 network (similar to an Amazon VPC) and then selecting how local node networks are exposed and translated into the the virtual address space.</p><p>The following steps illustrate how to configure the Trustgrid VPN feature and will need to be configured on all <a href=https://docs.trustgrid.io/docs/nodes/>nodes</a>/<a href=https://docs.trustgrid.io/docs/clusters/>clusters</a> that need to communicate across the virtual network.</p><ol><li>Create the Virtual Network
Under <code>Domains</code> -> <code>Domain</code> -> <code>Virtual Networks</code> create the <code>Virtual Network</code>. All gateway/edge nodes deployed and attached to this virtual network will need to be assigned a subnet out of this IP space. It is important to ensure the CIDR created is large enough to encompass all future node deployments. In this example the entire IPV4 space is being used. This IP space is only applicable to the individual virtual network therefore if there are multiple virtual networks there is no overlap or conflict in IP space allocation.</li></ol><p><img src=create-vn.png alt=img></p><ol start=2><li>Create <a href=https://docs.trustgrid.io/docs/domain/virtual-networks/routes/>Routes</a> for the desired Virtual CIDR with the destination being either a single node or a cluster if an HA deployment.</li></ol><p><img src=create-vn2.png alt=img></p><ol start=3><li>Create the appropriate ACL’s if desired for only allowing specific traffic to pass. An ACL is required for any traffic to pass as it is a zero trust model. If traffic is already filtered before reaching the Trustgrid nodes then at minimum an <code>Any:Any</code> rule will need to be created as seen below.</li></ol><p><img src=create-vn3.png alt=img></p><ol start=4><li>Attach Virtual Network to Node / Cluster
Select the node or cluster and under vpn attach the virtual network. Define the validation CIDR which should match the route created. NAT rules can only be created within this CIDR.</li></ol><p><img src=detach2.png alt=img></p><ol start=5><li>Select the appropriate interface to attach the virtual network to. This can be a physical interface or a virtual vlan interface and should be whichever interface clients will be using as the next hop to reach the remote networks. Configure the appropriate Inside and Outside NATs and then save the configuration. NATs explained in further detail below.</li></ol><p><img src=remove.png alt=img></p><h4 id=inside-nat>Inside NAT:</h4><p>An inside NAT defines how a local device IP address translates into a virtual network address. For instance, a local device may have a local IP address of 192.168.1.100, but you may want it to appear to other devices or applications on the virtual network as IP address 10.0.20.100. Or you may want an entire block of local IP addresses to show up on the virtual network as a different block. You can do this translation via Inside NATs. Inside NAT&rsquo;s also control what local devices can participate on the virtual network. If a local device does not have an inside NAT configured that includes its IP address, it can&rsquo;t access or be accessed by other devices on the network. To add an inside NAT you must enter the following information:</p><ol><li><p>Local CIDR - The local IP address or address block that should be mapped into the virtual network. It should be entered in CIDR block format (eg - 192.168.100.0/24 or 192.168.100.51/32).</p></li><li><p>Virtual CIDR - The network IP address or addresses that the local IP addresses should be mapped to, also entered in CIDR block format.</p></li></ol><p>Note that network addresses map 1x1 with local addresses, so the prefix length (the /xx number of the CIDR) should be the same in both the local and network CIDR blocks of the inside NAT entry.</p><h4 id=outside-nat>Outside NAT:</h4><p>By default, when a device on the local network of a node receives traffic from a remote device on the network, the remote device IP address will be the IP address that was entered in the local CIDR block for the remote node&rsquo;s inside NAT entry for the remote device. For instance, if the remote device was mapped to network address 10.0.100.1, then its traffic on the local network will appear to come from IP address 10.0.100.1. However due to the local network configuration, there may be some situations where it is desirable to translate remote network addresses before egressing onto the local network. For instance on a local network of 192.168.0.0/16, a user may want the remote devices virtual network IP of 10.0.100.1 to be translated to 192.168.50.5 so that it fits better into the local network setup. This kind of translation can be achieved by adding outside nats. To add an outside NAT you must enter the following information:</p><ol><li><p>Network Group - The network IP address or addresses that should be translated before egressing onto the local network. This should be entered in CIDR block format.</p></li><li><p>Local CIDR - The local IP address or addresses that the network addresses should be mapped to, also entered in CIDR format.</p></li></ol><p>Note there are situations where it may be desirable to make multiple remote devices masquerade as one local IP address though the use of port address translation (PAT). This can be achieved by defining an outside nat in which the network CIDR contains a larger address space than the local CIDR. For instance, an entry with network CIDR 10.0.1.0/24 and local CIDR 192.168.100.10 would make all remote devices with network IP addresses in 10.0.1.0/24 appear as IP address 192.168.100.10 on the local network.</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified February 22, 2023: <a href=https://github.com/trustgrid/docs/commit/228efe708455c45ccc2884b446fd55adab66753b>clean up getting started menu (228efe7)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel=noopener href=https://www.linkedin.com/company/trustgrid/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/trustgrid aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Trustgrid All Rights Reserved</small>
<small class=ml-1><a href=https://trustgrid.io target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=/js/main.min.f1a20e761a85478d0ce3298a01e295324be8858ef8f2d2baac6737980799b320.js integrity="sha256-8aIOdhqFR40M4ymKAeKVMkvohY748tK6rGc3mAeZsyA=" crossorigin=anonymous></script>
<script src=/js/prism.js></script>
<script src=/js/tabpane-persist.js></script></body></html>