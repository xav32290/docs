<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://trustgrid.github.io/docs/tutorials/operations-runbook/><link rel=alternate type=application/rss+xml href=https://trustgrid.github.io/docs/tutorials/operations-runbook/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/docs/favicons/favicon.ico><link rel=apple-touch-icon href=/docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/docs/favicons/android-192x192.png sizes=192x192><title>Operations Runbook |</title><meta name=description content="Trustgrid Network Device and API documentation"><meta property="og:title" content="Operations Runbook"><meta property="og:description" content="Trustgrid Network Device and API documentation"><meta property="og:type" content="website"><meta property="og:url" content="https://trustgrid.github.io/docs/tutorials/operations-runbook/"><meta itemprop=name content="Operations Runbook"><meta itemprop=description content="Trustgrid Network Device and API documentation"><meta name=twitter:card content="summary"><meta name=twitter:title content="Operations Runbook"><meta name=twitter:description content="Trustgrid Network Device and API documentation"><link rel=preload href=/docs/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css as=style><link href=/docs/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/docs/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99793053-3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-99793053-3")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/docs/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 469 106"><defs><style>.cls-1{fill:#6b6b6b}.cls-2{fill:#226ce0}</style></defs><title>Trustgrid-Logo-Grey</title><path class="cls-1" d="M.35 28.58H29.26V-.33H.35zM7.13 6.45H22.47V21.8H7.13z"/><path class="cls-1" d="M67.82-.33H38.9V28.58H67.82zM61 21.8H45.68V6.45H61z"/><path class="cls-1" d="M.35 67.13H29.26V38.22H.35zM7.13 45H22.47V60.35H7.13z"/><path class="cls-1" d="M106.36 38.22H77.45v12.3H67.82V41.27L85.26 23.83l-3.06-3L64.76 38.22H38.9V67.13H67.82V54.83h9.63v12.3h12.3V80.39h4.31V67.13h12.3zM61 60.35H45.68V45H61zm38.55.0H84.23V45H99.58z"/><path class="cls-1" d="M.35 105.69H29.26V76.77H.35zM7.13 83.55H22.47V98.9H7.13z"/><path class="cls-1" d="M38.9 105.69H67.82V76.77H38.9zm6.78-22.14H61V98.9H45.68z"/><path class="cls-2" d="M153.94 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22H140V38.78h13.2v5.78H140V67q0 3.59 1.31 5.13a4.8 4.8.0 003.91 1.55 13.59 13.59.0 006.67-2z"/><path class="cls-2" d="M176.74 39.56A18 18 0 01186 37.07V44.4q-6.58-.24-10.66 3.42a14.51 14.51.0 00-4.64 9.85V80.39h-7.57V37.32h7.57V46.6a15.52 15.52.0 016-7"/><path class="cls-2" d="M232.34 37.32V80.39h-7.65V71.27q-4.23 9.2-16 9.36-7.48.0-11.72-4.44t-4.24-12.25V37.32h7.66V61.9q0 5.46 3 8.51a10.87 10.87.0 008.18 3.06 12.11 12.11.0 009.57-4.28 16 16 0 003.54-10.7V37.32z"/><path class="cls-2" d="M260.47 44.24a21.21 21.21.0 00-6.15-1 10.48 10.48.0 00-5.49 1.26 4.21 4.21.0 00-2.08 3.87 4.3 4.3.0 002.32 4 34.68 34.68.0 007 2.73 54.86 54.86.0 017.33 2.6 13 13 0 014.85 3.83 10.51 10.51.0 012 6.67 10.58 10.58.0 01-4.6 9.29 19.65 19.65.0 01-11.44 3.17 28.35 28.35.0 01-9.32-1.55 21.07 21.07.0 01-7.61-4.39l2.85-5.54a20.07 20.07.0 006.63 3.91 22 22 0 007.69 1.47 11.45 11.45.0 006-1.39 4.61 4.61.0 002.28-4.23 4.82 4.82.0 00-2.4-4.4 32.85 32.85.0 00-7.29-2.93 48.4 48.4.0 01-7-2.48 12.43 12.43.0 01-4.64-3.71A10 10 0 01239.5 49q0-6 4.4-9a19.07 19.07.0 0111-3 27.13 27.13.0 017.69 1.1 23 23 0 016.56 3l-2.77 5.78a26 26 0 00-5.9-2.6"/><path class="cls-2" d="M303.42 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22h7.65V38.78h13.19v5.78H289.49V67c0 2.39.44 4.1 1.3 5.13a4.81 4.81.0 003.91 1.55 13.62 13.62.0 006.68-2z"/><path class="cls-1" d="M352.92 36.34V76.48a19.18 19.18.0 01-3 10.71 19.61 19.61.0 01-8.43 7.08A29.79 29.79.0 01329 96.75a36.74 36.74.0 01-10.66-1.54 34 34 0 01-9-4.16l5.05-10a25.68 25.68.0 006.51 3.17 22.5 22.5.0 007.08 1.14 12.11 12.11.0 007.74-2.27 7.52 7.52.0 002.85-6.2V72.16Q334.12 77.95 326 78a17.69 17.69.0 01-16.41-10.14 24.71 24.71.0 01-2.4-11.12 24.42 24.42.0 012.32-10.91A17.35 17.35.0 01316 38.46a17.92 17.92.0 019.61-2.61A17.42 17.42.0 01333 37.36a14.36 14.36.0 015.5 4.35V36.34zM336.07 64.51a11 11 0 002.44-7.41 11.16 11.16.0 00-2.44-7.49 8.69 8.69.0 00-12.91.0 11 11 0 00-2.48 7.45 10.85 10.85.0 002.48 7.41 8.18 8.18.0 006.47 2.85 8.08 8.08.0 006.44-2.85"/><path class="cls-1" d="M383.9 37.8a16.63 16.63.0 018.26-2V49c-.49.0-1.22-.08-2.2-.08a13.4 13.4.0 00-8.3 2.4A9.18 9.18.0 00378 57.92V80.39H363.5v-44H378v7.33a16 16 0 015.9-5.87"/><path class="cls-1" d="M411.09 18.22a7.55 7.55.0 012.16 5.58 7.59 7.59.0 01-2.16 5.54 8 8 0 01-11 0 7.59 7.59.0 01-2.16-5.54 7.55 7.55.0 012.16-5.58 8.1 8.1.0 0111 0M398.51 36.34h14.41V80.39H398.51z"/><path class="cls-1" d="M468.45 20V80.39H454v-5.7a14.92 14.92.0 01-5.58 4.68A16.94 16.94.0 01440.93 81a20.15 20.15.0 01-10.75-2.85 19.16 19.16.0 01-7.2-8 26.51 26.51.0 01-2.57-11.93 25.77 25.77.0 012.53-11.72A18.6 18.6.0 01430 38.62a20.05 20.05.0 0110.59-2.77 17.24 17.24.0 017.61 1.63A16.19 16.19.0 01454 42.12V20zm-17.1 46.5A11.77 11.77.0 00454 58.57a11.76 11.76.0 00-2.61-8 8.58 8.58.0 00-6.84-3 8.67 8.67.0 00-6.88 3.05A11.69 11.69.0 00435 58.57a11.68 11.68.0 002.64 7.93 8.68 8.68.0 006.88 3.06 8.53 8.53.0 006.84-3.06"/><path class="cls-2" d="M99.58 21.8H84.23V6.46H99.58zM106.36-.33H77.45V28.59h28.91z"/><path class="cls-2" d="M99.58 98.9H84.23V83.55H99.58zm6.78-22.13H77.45v28.92h28.91z"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/getting-started/><span>Getting Started</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/tutorials/><span class=active>Guides</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/help-center/><span>Help Center</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/release-notes/><span>Release Notes</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/docs/offline-search-index.4f2df6e0bd75fa175127233caa364130.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/tutorials/operations-runbook/>Return to the regular view of this page</a>.</p></div><h1 class=title>Operations Runbook</h1><ul><li>1: <a href=#pg-04cdaed49b19026180114b6a895715ae>Cluster Failover Response</a></li><li>2: <a href=#pg-f1997f9fc525dd18c259eee4c479bdbb>Control Plane Disconnect</a></li><li>3: <a href=#pg-76ca6a98fdf21fa75cb27a45b626d470>Node Down Response</a></li><li>4: <a href=#pg-ac421cd7a8e4dc3a9177045b633b3556>Site Failover</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-04cdaed49b19026180114b6a895715ae>1 - Cluster Failover Response</h1><div class="pageinfo pageinfo-primary"><p>When the active (master) member of the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> goes unhealthy the standby member will take over the active role. This process should be automatic and not require manual intervention. However, in certain circumstances, such as the unexpected failover of a public gateway, it is worth investigating to confirm traffic is in a healthy state.</p></div><h3 id=possible-messages>Possible Messages</h3><ul><li><p>Master role assumed - failover</p><ul><li>Indicates the master role has moved from the designated master (primary) to the backup/secondary <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a></li></ul></li><li><p>Master role reclaimed by expected master</p><ul><li>Indicates the master role has returned to the designated master</li></ul></li></ul><h3 id=failover-process>Failover Process</h3><p>Below is a brief description events that occur during a failover process:</p><ul><li><p>The <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> assuming the master role will ARP to the network that it now owns the <a href=https://trustgrid.github.io/docs/docs/clusters/>Cluster</a> Virtual IP (VIP)</p></li><li><p>The <a href=https://trustgrid.github.io/docs/docs/domain/virtual-networks/routes/>Domain route</a> table will update that the assuming <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> should receive all traffic for the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> (<em>clustername-master</em>)</p></li><li><p>The assuming <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> will load all NAT entries associated with the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a></p></li></ul><h3 id=response-process>Response Process</h3><p>After a failover or failback it is necessary to verify that traffic is flowing appropriately.</p><ol><li><p>Login to the portal and navigate to the affected <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster’s</a> page</p></li><li><p>Verify that only a single <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> shows as master</p></li><li><p>On the <code>Configuration</code> → <code>Network</code> tab note the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> VIP</p></li></ol><p><img src=cluster-virtual-ip2.png alt=img></p><ol><li><p>Click on the indicated current master</p><p>a. Verify the VPN Route Table shows</p><pre><code>i. Navigate to the `Configuration` → `VPN` tab

ii. Launch the &quot;View Virtual Route Table&quot; tool
</code></pre><p><img src=virtual-network-tools.png alt=img></p><pre><code>iii. Verify that routes show as “available true”
</code></pre><p><img src=routing-tables.png alt=img></p><pre><code>   1. If the cluster is a gateway cluster there may be many routes and not all be active, just confirm many show as available.

   2. The route to the management VIP for the other node in the cluster will always be false.
</code></pre><p>b. Verify traffic is flowing through the appropriate node.</p><pre><code>i. Navigate to the `Configuration` → `Network` tab

ii. Confirm the interface associated with the Cluster VIP is selected

   3. For single interface nodes: ETH0 / Network Adapter 1 - WAN Adapter

   4. For dual interface nodes: ETH1 / Network Adapter 2 - LAN Adapter

iii. Open the `Sniff Interface Traffic` tool.

    5. Set the filter to “host clusterVIP” without quotes and replacing clusterVIP with the appropriate Cluster virtual IP. Click `start session`.

    6. Confirm that you see traffic flowing through the interface. **Continue monitoring for several minutes to confirm the traffic is maintained.**

    7. Leave the Sniff Interface Tool running while completing the next step

iv. Repeat steps i-iii on the node that **is not** currently indicated as the master.

    1.You want to verify there is **no traffic for the cluster VIP running through the non-master node**.

    8. You may see a periodic ARP from the cluster master, but that should be it.
</code></pre><ol><li><p>Compare traffic volume before and after the failover</p><p>a. If the event was a failover and failback compare traffic from the current master</p><p>b. If the event was a failover but has not failed back you will need to compare traffic volume on the current master to the volume on the previous master</p><pre><code> i. e.g if traffic failed from node1 to node2, compare node1’s traffic prior to the failover to the volume of traffic on node2 after the failover
</code></pre></li></ol></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-f1997f9fc525dd18c259eee4c479bdbb>2 - Control Plane Disconnect</h1><blockquote><p>When the Control Plane is disconnected there is no way to utilize remote tools to resolve the issue so you will need to contact the End-user technical resource for the site to troubleshoot</p></blockquote><p>When troubleshooting the control plane it is a good idea to familiarize yourself with the [Edge Node Startup & Update Communication Process].</p><table><thead><tr><th>Network Requirements</th></tr><tr><td>In order to connect to the Trustgrid Control Plane, the following <strong>outbound traffic</strong> must be allowed from the node’s configured primary interface IP address<br><ul><li>TCP Port 443 and TCP/UDP 8443 to:</li><ul><li>35.171.100.16/28</li><li>34.223.12.192/28</li></ul></li><li>TCP/UDP Port 53 to the configured DNS servers. These DNS servers must be able to resolve DNS requests for the trustgrid.io domain</li></ul></table><ol><li><p>Triage the total site connectivity to see if actions can be taken to restore functionality for the edge site while troubleshooting the specific node</p></li><li><p>Confirm with the site tech:</p><p>a. There are no known power or internet issues at the site</p><p>b. No changes have been made to any firewalls between the Trustgrid node and the internet (if applicable). In order to connect the Trustgrid node must have access to the Network Requirements defined above.</p></li><li><p>Have the site tech attempt to ping the inside interface IP address(es) to see if the device is showing as powered up and online. If the site is using a single-interface configuration this would be the Network Adapter 1 - WAN Interface IP(s) in the portal.</p><p>a. If the ping is successful you have determined the device has power and that the operating system and Trustgrid software are running. In this case, you can focus on internet side issues.</p><p>b. If the ping fails, work with the site tech to:</p><pre><code> i. Confirm the node is powered on

 ii. Connect directly to the network of the inside interface and attempt ping from there. They should also connect directly to the inside interface and statically configure an IP in the same network.
</code></pre></li><li><p>Attempt power cycling the node by removing power and returning from physical devices or using the hypervisor management tools for virtual nodes.</p></li><li><p>Connect to the console of the device</p><p>a. A normal node looks something like this</p></li></ol><p><img src=normal-node.png alt=img></p><pre><code>i. Work with the onsite tech to login to the Trustgrid Local Console Utility.  This tools will display connectivity status and allow you to alter the WAN/outside IP settings if needed.
</code></pre><p>b. If you see a screen like below attempt rebooting the device to restore connectivity. If that works contact Trustgrid support so we can investigate further.</p><p><img src=more-node.png alt=img></p><ol><li><p>Disconnect the cable from the WAN/Outside port of the Trustgrid node and connect to a laptop NIC. Statically assign the same IP and DNS settings that the Trustgrid node is using. Confirm the following:</p><p>a. Using <code>nslookup</code> or <code>dig</code> to confirm you can resolve zuul.trustgrid.io</p><p>b. Open a browser and navigate to <a href=https://zuul.trustgrid.io:8443>https://zuul.trustgrid.io:8443</a></p><pre><code> i. If the device can connect to that server and port you should see a warning like this because Trustgrid uses its own Certificate Authority (CA)
</code></pre></li></ol><p><img src=link.png alt=img></p><pre><code>    1. Click `Not Secure` and then click `Certificate (invalid)`
</code></pre><p><img src=certificate-invalid.png alt=img></p><pre><code>    1. You should expect to see a chain like the below.
</code></pre><p><img src=chain.png alt=img></p><pre><code>        a. If there are any different certificates or CAs that indicates something like DPI-SSL/HTTPS Proxy is interfering with the handsake.  See [this page] for resolution requirements.

    ii. If the browser says it cannot connect this indicates a firewall or routing issue upstream.
</code></pre><ol><li><p>If possible, capture traffic between the Trustgrid node and the internet. Specifically, the capture should filter to only see traffic from the Trustgrid node’s IP address and TCP port 8443 and TCP/UDP port 53. Common problems seen include:</p><p>a. Blocked DNS - Edge Node Behavior When DNS Fails</p><p>b. Blocked port 8443 to the Trustgrid Networks - Edge Node Behavior When Port 8443 to Trustgrid Public Networks is Blocked</p><p>c. DPI-SSL or HTTPS altering the TLS certificate chain - Edge Node Behavior When SSL / TLS Certificate is Altered</p></li></ol><h1 id=need-proper-links-to-use-and-need-to-find-how-to-add-links-to-indent-format><strong>NEED PROPER LINKS TO USE AND NEED TO FIND HOW TO ADD LINKS TO INDENT FORMAT</strong></h1></div><div class=td-content style=page-break-before:always><h1 id=pg-76ca6a98fdf21fa75cb27a45b626d470>3 - Node Down Response</h1><div class="pageinfo pageinfo-primary"><p>This process is intended to help customer support personnel quickly identify the scope of a <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> down problem and get services back online as quickly as possible.</p></div><h3 id=node-down-triage>Node Down Triage</h3><h4 id=triage-checklist>Triage Checklist</h4><ul><li><p>Determine Production Status of the Trustgrid Node</p></li><li><p>Confirm High Availability or Disaster Recover is Functioning</p><ul><li><p>If clustered, is the partner active and working</p></li><li><p>If there is a second site, confirm if it is active</p></li></ul></li><li><p>Determine the type of outage (Control Plane, Data Plane or Both)</p></li></ul><h3 id=determine-production-status-of-the-trustgrid-node>Determine Production Status of the Trustgrid Node</h3><p>Use the <a href=https://trustgrid.github.io/docs/docs/nodes/tags/prod-status-tag/%7D>Production Status Tags</a> to determine if the <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> is in use and expected to be online.</p><h3 id=confirm-high-availability-or-disaster-recover-is-functioning>Confirm High Availability or Disaster Recover is Functioning</h3><p>Before troubleshooting why a <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> is down we should determine if the services it provided can be provided in the interim by a cluster member or devices at a secondary/disaster-recovery site.</p><h5 id=is-the-node-a-cluster-member>Is the Node a Cluster Member</h5><ul><li><p>Check if partner member is online:</p><ul><li><p>If Yes:</p><pre><code>- Confirm partner member is now active and operating normally.

- The issue is limited to this specific Node. This could be its power input, the hardware or operating system, configuration, or its internet connection (if different than partner member).
</code></pre></li><li><p>If No:</p><pre><code>- Possible site-level issue including power or internet provider

- Proceed to Secondary / DR Site
</code></pre></li></ul></li></ul><h5 id=is-there-a-secondary--dr-site-for-this-nodecluster>Is there a Secondary / DR Site for this Node/Cluster?</h5><ul><li><p>Are the <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> deployed at the secondary site online in the Trustgrid?</p><ul><li><p>If No:</p><pre><code>- Confirm nodes for other end-user sites are not also offline which might indicate a wider spread issue. Escalate to Trustgrid Support if you suspect a major issue with the Trustgrid system.

- If limited to a single customer it is recommended to contact that customer immediately. They may be experiencing an outage or performing maintenance.
</code></pre></li><li><p>If Yes:</p><pre><code>- If the customer is configured for Automatic Failover between sites, verify that traffic is flowing through the active member at the secondary site.

- If the customer is configured for Manual Failover you will need to adjust the route destination to point to the secondary site.
</code></pre></li></ul></li></ul><h3 id=determine-connectivity-status-of-the-trustgrid-node>Determine Connectivity Status of the Trustgrid Node</h3><p>Because Trustgrid provides independent control and data planes, there are a few ways it can manifest as “down”:</p><tr><th>Control Plane Down</th><td>The <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> appears offline from within the Trustgrid portal. This indicates that the <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> shutdown or has not sent a heartbeat notification to Trustgrid within the past 10 minutes.</td></tr><tr><th>Data Plane Down</th><td>The <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> appears online from within the portal but reports it is unable to connect to one or more gateway nodes. This can be indicated by the Data Plane Status indicator when viewing the <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> in the portal, or by receiving a “Gateway Connectivity Health Check” failure <a href=https://trustgrid.github.io/docs/docs/alarms/events/>event</a> notification. Both of these only work if the Control Plane is currently working.</td></tr><tr><th>Both Control and Data Plane Down</th><td>In this situation the <a href=https://trustgrid.github.io/docs/docs/nodes/>node</a> appears down in the Trustgrid Portal and users/applications are unable to reach services across the data plane between the Gateway and Edge sites. This is the most common scenario. While the Data Plane is most critical for the services provided across the device, first priority should be restoring the Control Plane connection so that additional troubleshooting tools are available. Often this process also uncovers the reason the data plane is down.</td></tr></div><div class=td-content style=page-break-before:always><h1 id=pg-ac421cd7a8e4dc3a9177045b633b3556>4 - Site Failover</h1><div class="pageinfo pageinfo-primary"><p>The below processes should be used to move traffic between sites in event of a complete site down scenario. This is handled by the Virtual Network Route Table.</p></div><div class="alert alert-primary" role=alert>In the examples below, xxxEdgeCluster is the primary site and xxx-edge3 is the secondary/disaster recovery site.</div><h3 id=manual-failover>Manual Failover</h3><p>When a customer has selected manual failover, a portal user will need to adjust the destination of all <a href=https://trustgrid.github.io/docs/docs/domain/virtual-networks/routes/>routes</a> currently pointed at the failed site.</p><h4 id=failing-over>Failing Over</h4><blockquote><p>There will usually be <a href=https://trustgrid.github.io/docs/docs/domain/virtual-networks/routes/>routes</a> for the <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes&rsquo;</a> Virtual Management IP. These should not be changed in this process.</p></blockquote><ol><li><p>In the portal, navigate to <code>Domain</code> → <code>Virtual Networks</code> and then select the appropriate Virtual network.</p></li><li><p>Select the <code>Routes</code> panel from the left navigation bar.</p></li><li><p>Filter the route table either using the node/cluster names or network to be failed over (shown below).</p></li></ol><p><img src=route-table.png alt=img></p><pre><code>a. If there is more than one network that needs to be routed to the secondary site using node/cluster names to filter is more efficient
</code></pre><ol><li>Clear the destination field and start typing the name of the secondary site node/cluster. Select the appropriate node/cluster from the list.</li></ol><p><img src=destination-field.png alt=img></p><ol><li><p>Click <code>Save</code>. Then select <code>Review Changes</code>.</p></li><li><p>You should see a modified <a href=https://trustgrid.github.io/docs/docs/domain/virtual-networks/routes/>route</a> for each network you adjusted showing the previous and current destination. If everything looks correct click <code>Apply Changes</code>.</p></li></ol><p><img src=apply-changes.png alt=img></p><ol><li>It may take 1-2 minutes for nodes to pull down the updated routing table. Once that has completed any new flow or connection will automatically be sent to the new destination node.</li></ol><div class="alert alert-primary" role=alert>If the node/cluster is still online at the primary site, and there are existing flows/connections they will persist at that site. To clear them restart the active node at the primary site. See the last step in the Forcing Failover section below for instructions.</div><h4 id=failing-back>Failing Back</h4><p>To send traffic back to the primary site reverse the changes in the routing performed during the failover.</p><h3 id=automatic-failover>Automatic Failover</h3><p>When a customer has selected automatic failover between sites there should be no intervention required if the primary site goes offline. The route table will be configured with multiple routes with different metrics. When determining where to send virtual traffic a node will select:</p><ul><li>The most specific route - meaning if there is a route for 192.168.100.1/32 and another for 192.168.100.0/24, the /32 route will be preferred</li><li>With the lowest metric</li><li>that is currently available - meaning this node has an active tunnel to the destination node/cluster</li></ul><p>Below reflects a typical automatic failover configuration for a network</p><h4 id=forcing-failover-or-prevent-auto-failback>Forcing Failover or Prevent Auto-Failback</h4><p>If it is necessary to move traffic to the secondary site without the primary site going offline follow the below process.</p><p>Also, if a failure of the primary site has occurred and you want to ensure traffic does not automatically return to that site if it comes online (e.g. it is unstable) you can follow the same process.</p><ol><li><p>In the portal, navigate to <code>Domain</code> → <code>Virtual Networks</code> and then select the appropriate Virtual network.</p></li><li><p>Select <code>Routes</code> from the left navigation bar.</p></li><li><p>Filter the route table either using the node/cluster names or network to be failed over (shown below)</p></li></ol><p><img src=route-table.png alt=img></p><pre><code>a. If there is more than one network that needs to be routed to the secondary site using node/cluster names to filter is more efficient
</code></pre><ol><li>Adjust the metric so that the primary site is a higher number than the secondary site. The maximum metric value is 200.</li></ol><p><img src=metric.png alt=img></p><p>Click <code>Save</code> and navigate to <code>Review Changes</code></p><p>You should see a change like below for each route adjusted. Click <code>Apply Changes</code> if all looks correct.</p><p><img src=apply-changes-metric.png alt=img></p><ol><li><p>It may take 1-2 minutes for nodes to pull down the updated route table. At that point, they will route new flows/connections to the new destination.</p></li><li><p>Because the primary site is still online, you will need to restart the active node at that site to clear out any existing flows/connections.</p><p>a. If it&rsquo;s a cluster, navigate to the cluster and then select the currently active node from the overview page. If a single node site, navigate directly to that node.</p><p>b. From the toolbar select <code>Restart</code></p><p>c. Enter the node’s name and click <code>confirm</code></p></li></ol><h3 id=restore-traffic-to-primary-site>Restore Traffic to Primary Site</h3><p>To restore traffic to the primary site repeat the above steps but set the route for the primary site to have the lowest metric.</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel=noopener href=https://www.linkedin.com/company/trustgrid/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/trustgrid aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Trustgrid All Rights Reserved</small>
<small class=ml-1><a href=https://trustgrid.io target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=/docs/js/main.min.f1a20e761a85478d0ce3298a01e295324be8858ef8f2d2baac6737980799b320.js integrity="sha256-8aIOdhqFR40M4ymKAeKVMkvohY748tK6rGc3mAeZsyA=" crossorigin=anonymous></script>
<script src=/docs/js/prism.js></script>
<script src=/docs/js/tabpane-persist.js></script></body></html>