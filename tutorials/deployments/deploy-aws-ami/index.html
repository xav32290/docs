<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Deploy a Trustgrid Node AMI in AWS |</title><meta name=description content="Standing up a Trustgrid node in AWS is easy using an Amazon AMI. Trustgrid nodes in AWS use two network interfaces - a management and data interface. The management interface communicates with Trustgrid Cloud Management systems. The data interface is used to terminate TLS tunnels from Edge Nodes.
Notes The cloudformation template below works with an AMI currently published in US-EAST1. Deploying in other regions requires working with Trustgrid Support Logs /var/log/syslog, /var/log/secure, and /var/log/trustgrid/tg-default."><meta property="og:title" content="Deploy a Trustgrid Node AMI in AWS"><meta property="og:description" content="Standing up a Trustgrid node in AWS is easy using an Amazon AMI. Trustgrid nodes in AWS use two network interfaces - a management and data interface. The management interface communicates with Trustgrid Cloud Management systems. The data interface is used to terminate TLS tunnels from Edge Nodes.
Notes The cloudformation template below works with an AMI currently published in US-EAST1. Deploying in other regions requires working with Trustgrid Support Logs /var/log/syslog, /var/log/secure, and /var/log/trustgrid/tg-default."><meta property="og:type" content="article"><meta property="og:url" content="https://docs.trustgrid.io/tutorials/deployments/deploy-aws-ami/"><meta property="article:section" content="tutorials"><meta property="article:modified_time" content="2023-02-14T12:26:49+13:00"><meta itemprop=name content="Deploy a Trustgrid Node AMI in AWS"><meta itemprop=description content="Standing up a Trustgrid node in AWS is easy using an Amazon AMI. Trustgrid nodes in AWS use two network interfaces - a management and data interface. The management interface communicates with Trustgrid Cloud Management systems. The data interface is used to terminate TLS tunnels from Edge Nodes.
Notes The cloudformation template below works with an AMI currently published in US-EAST1. Deploying in other regions requires working with Trustgrid Support Logs /var/log/syslog, /var/log/secure, and /var/log/trustgrid/tg-default."><meta itemprop=dateModified content="2023-02-14T12:26:49+13:00"><meta itemprop=wordCount content="976"><meta itemprop=keywords content="aws,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploy a Trustgrid Node AMI in AWS"><meta name=twitter:description content="Standing up a Trustgrid node in AWS is easy using an Amazon AMI. Trustgrid nodes in AWS use two network interfaces - a management and data interface. The management interface communicates with Trustgrid Cloud Management systems. The data interface is used to terminate TLS tunnels from Edge Nodes.
Notes The cloudformation template below works with an AMI currently published in US-EAST1. Deploying in other regions requires working with Trustgrid Support Logs /var/log/syslog, /var/log/secure, and /var/log/trustgrid/tg-default."><link rel=preload href=/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css as=style><link href=/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99793053-3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-99793053-3")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 469 106"><defs><style>.cls-1{fill:#6b6b6b}.cls-2{fill:#226ce0}</style></defs><title>Trustgrid-Logo-Grey</title><path class="cls-1" d="M.35 28.58H29.26V-.33H.35zM7.13 6.45H22.47V21.8H7.13z"/><path class="cls-1" d="M67.82-.33H38.9V28.58H67.82zM61 21.8H45.68V6.45H61z"/><path class="cls-1" d="M.35 67.13H29.26V38.22H.35zM7.13 45H22.47V60.35H7.13z"/><path class="cls-1" d="M106.36 38.22H77.45v12.3H67.82V41.27L85.26 23.83l-3.06-3L64.76 38.22H38.9V67.13H67.82V54.83h9.63v12.3h12.3V80.39h4.31V67.13h12.3zM61 60.35H45.68V45H61zm38.55.0H84.23V45H99.58z"/><path class="cls-1" d="M.35 105.69H29.26V76.77H.35zM7.13 83.55H22.47V98.9H7.13z"/><path class="cls-1" d="M38.9 105.69H67.82V76.77H38.9zm6.78-22.14H61V98.9H45.68z"/><path class="cls-2" d="M153.94 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22H140V38.78h13.2v5.78H140V67q0 3.59 1.31 5.13a4.8 4.8.0 003.91 1.55 13.59 13.59.0 006.67-2z"/><path class="cls-2" d="M176.74 39.56A18 18 0 01186 37.07V44.4q-6.58-.24-10.66 3.42a14.51 14.51.0 00-4.64 9.85V80.39h-7.57V37.32h7.57V46.6a15.52 15.52.0 016-7"/><path class="cls-2" d="M232.34 37.32V80.39h-7.65V71.27q-4.23 9.2-16 9.36-7.48.0-11.72-4.44t-4.24-12.25V37.32h7.66V61.9q0 5.46 3 8.51a10.87 10.87.0 008.18 3.06 12.11 12.11.0 009.57-4.28 16 16 0 003.54-10.7V37.32z"/><path class="cls-2" d="M260.47 44.24a21.21 21.21.0 00-6.15-1 10.48 10.48.0 00-5.49 1.26 4.21 4.21.0 00-2.08 3.87 4.3 4.3.0 002.32 4 34.68 34.68.0 007 2.73 54.86 54.86.0 017.33 2.6 13 13 0 014.85 3.83 10.51 10.51.0 012 6.67 10.58 10.58.0 01-4.6 9.29 19.65 19.65.0 01-11.44 3.17 28.35 28.35.0 01-9.32-1.55 21.07 21.07.0 01-7.61-4.39l2.85-5.54a20.07 20.07.0 006.63 3.91 22 22 0 007.69 1.47 11.45 11.45.0 006-1.39 4.61 4.61.0 002.28-4.23 4.82 4.82.0 00-2.4-4.4 32.85 32.85.0 00-7.29-2.93 48.4 48.4.0 01-7-2.48 12.43 12.43.0 01-4.64-3.71A10 10 0 01239.5 49q0-6 4.4-9a19.07 19.07.0 0111-3 27.13 27.13.0 017.69 1.1 23 23 0 016.56 3l-2.77 5.78a26 26 0 00-5.9-2.6"/><path class="cls-2" d="M303.42 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22h7.65V38.78h13.19v5.78H289.49V67c0 2.39.44 4.1 1.3 5.13a4.81 4.81.0 003.91 1.55 13.62 13.62.0 006.68-2z"/><path class="cls-1" d="M352.92 36.34V76.48a19.18 19.18.0 01-3 10.71 19.61 19.61.0 01-8.43 7.08A29.79 29.79.0 01329 96.75a36.74 36.74.0 01-10.66-1.54 34 34 0 01-9-4.16l5.05-10a25.68 25.68.0 006.51 3.17 22.5 22.5.0 007.08 1.14 12.11 12.11.0 007.74-2.27 7.52 7.52.0 002.85-6.2V72.16Q334.12 77.95 326 78a17.69 17.69.0 01-16.41-10.14 24.71 24.71.0 01-2.4-11.12 24.42 24.42.0 012.32-10.91A17.35 17.35.0 01316 38.46a17.92 17.92.0 019.61-2.61A17.42 17.42.0 01333 37.36a14.36 14.36.0 015.5 4.35V36.34zM336.07 64.51a11 11 0 002.44-7.41 11.16 11.16.0 00-2.44-7.49 8.69 8.69.0 00-12.91.0 11 11 0 00-2.48 7.45 10.85 10.85.0 002.48 7.41 8.18 8.18.0 006.47 2.85 8.08 8.08.0 006.44-2.85"/><path class="cls-1" d="M383.9 37.8a16.63 16.63.0 018.26-2V49c-.49.0-1.22-.08-2.2-.08a13.4 13.4.0 00-8.3 2.4A9.18 9.18.0 00378 57.92V80.39H363.5v-44H378v7.33a16 16 0 015.9-5.87"/><path class="cls-1" d="M411.09 18.22a7.55 7.55.0 012.16 5.58 7.59 7.59.0 01-2.16 5.54 8 8 0 01-11 0 7.59 7.59.0 01-2.16-5.54 7.55 7.55.0 012.16-5.58 8.1 8.1.0 0111 0M398.51 36.34h14.41V80.39H398.51z"/><path class="cls-1" d="M468.45 20V80.39H454v-5.7a14.92 14.92.0 01-5.58 4.68A16.94 16.94.0 01440.93 81a20.15 20.15.0 01-10.75-2.85 19.16 19.16.0 01-7.2-8 26.51 26.51.0 01-2.57-11.93 25.77 25.77.0 012.53-11.72A18.6 18.6.0 01430 38.62a20.05 20.05.0 0110.59-2.77 17.24 17.24.0 017.61 1.63A16.19 16.19.0 01454 42.12V20zm-17.1 46.5A11.77 11.77.0 00454 58.57a11.76 11.76.0 00-2.61-8 8.58 8.58.0 00-6.84-3 8.67 8.67.0 00-6.88 3.05A11.69 11.69.0 00435 58.57a11.68 11.68.0 002.64 7.93 8.68 8.68.0 006.88 3.06 8.53 8.53.0 006.84-3.06"/><path class="cls-2" d="M99.58 21.8H84.23V6.46H99.58zM106.36-.33H77.45V28.59h28.91z"/><path class="cls-2" d="M99.58 98.9H84.23V83.55H99.58zm6.78-22.13H77.45v28.92h28.91z"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/getting-started/><span>Getting Started</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/tutorials/><span class=active>Guides</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/help-center/><span>Help Center</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/release-notes/><span>Release Notes</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.a21dbc29cab37fd8aa65bf80abd90ba4.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.a21dbc29cab37fd8aa65bf80abd90ba4.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><a href=/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-tutorials><span>Guides</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsoperations-runbook-li><a href=/tutorials/operations-runbook/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsoperations-runbook><span>Operations Runbook</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbookcluster-failover-response-li><a href=/tutorials/operations-runbook/cluster-failover-response/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcluster-failover-response><span>Cluster Failover Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbookcontrol-plane-disconnect-li><a href=/tutorials/operations-runbook/control-plane-disconnect/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcontrol-plane-disconnect><span>Control Plane Disconnect</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbooknode-down-response-li><a href=/tutorials/operations-runbook/node-down-response/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooknode-down-response><span>Node Down Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbooksite-failover-li><a href=/tutorials/operations-runbook/site-failover/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooksite-failover><span>Site Failover</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsapplying-changes-li><a href=/tutorials/applying-changes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsapplying-changes><span>Applying Changes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialswan-interface-ip-li><a href=/tutorials/wan-interface-ip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialswan-interface-ip><span>Changing the WAN Interface IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsftp-and-ftps-li><a href=/tutorials/ftp-and-ftps/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsftp-and-ftps><span>Configure FTP and FTPS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsconfig-l3-vpn-li><a href=/tutorials/config-l3-vpn/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsconfig-l3-vpn><span>Configure Layer 3 VPN</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsconfigure-wg-edge-node-li><a href=/tutorials/configure-wg-edge-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsconfigure-wg-edge-node><span>Configure WireGuard on an Edge Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsdeployments-li><a href=/tutorials/deployments/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeployments><span>Deployments</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsaws-ha-cluster-li><a href=/tutorials/deployments/aws-ha-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-cluster><span>AWS Requirements for HA Wireguard Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster-li><a href=/tutorials/deployments/aws-ha-ztna-gateway-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster><span>AWS Requirements for HA ZTNA Gateway Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws-li><a href=/tutorials/deployments/configure-ha-gateway-cluster-in-aws/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws><span>Configure HA Trustgrid Gateway Cluster in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-tutorialsdeploymentsdeploy-aws-ami-li><a href=/tutorials/deployments/deploy-aws-ami/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-aws-ami><span class=td-sidebar-nav-active-item>Deploy a Trustgrid Node AMI in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsdeploy-azure-li><a href=/tutorials/deployments/deploy-azure/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-azure><span>Deploy to Azure</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsdeploy-vsphere-li><a href=/tutorials/deployments/deploy-vsphere/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-vsphere><span>Deploy to vSphere</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsros-config-li><a href=/tutorials/deployments/ros-config/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsros-config><span>On a Stick Configuration</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssaml-okta-li><a href=/tutorials/saml-okta/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssaml-okta><span>Enable SAML with Okta</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsfind-ip-node-li><a href=/tutorials/find-ip-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsfind-ip-node><span>Find the IP Adress of a Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsgateway-tools-li><a href=/tutorials/gateway-tools/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsgateway-tools><span>Gateway Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers-li><a href=/tutorials/gateway-tools/monitoring-network-hops-to-peers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers><span>Monitoring Network Hops to Peers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsping-remote-node-li><a href=/tutorials/gateway-tools/ping-remote-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsping-remote-node><span>Ping Remote Node</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslimit-node-functionality-li><a href=/tutorials/limit-node-functionality/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslimit-node-functionality><span>Limit Node Functionality to Current Public IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsreboot-node-li><a href=/tutorials/reboot-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsreboot-node><span>Reboot a Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsremote-tools-li><a href=/tutorials/remote-tools/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsremote-tools><span>Remote Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsping-remote-virtual-host-li><a href=/tutorials/remote-tools/ping-remote-virtual-host/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsping-remote-virtual-host><span>Ping Remote Virtual Host</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolssniff-interface-traffic-li><a href=/tutorials/remote-tools/sniff-interface-traffic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolssniff-interface-traffic><span>Sniff Interface Traffic</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolstcp-port-test-li><a href=/tutorials/remote-tools/tcp-port-test/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolstcp-port-test><span>TCP Port Test</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsview-virtual-route-table-li><a href=/tutorials/remote-tools/view-virtual-route-table/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsview-virtual-route-table><span>View Virtual Route Table</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsrestart-node-li><a href=/tutorials/restart-node/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsrestart-node><span>Restart the Trustgrid Service on a Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslocal-console-utility-li><a href=/tutorials/local-console-utility/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utility><span>Trustgrid Local Console Utility</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslocal-node-ip-li><a href=/tutorials/local-node-ip/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-node-ip><span>Trustgrid Local UI for Node IP Reconfiguration</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/trustgrid/docs/tree/main/content/en/tutorials/deployments/deploy-aws-ami/index.md class=td-page-meta--view target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/trustgrid/docs/edit/main/content/en/tutorials/deployments/deploy-aws-ami/index.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/trustgrid/docs/new/main/content/en/tutorials/deployments/deploy-aws-ami/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/trustgrid/docs/issues/new?title=Deploy%20a%20Trustgrid%20Node%20AMI%20in%20AWS" class=td-page-meta--issue target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a>
<a id=print href=https://docs.trustgrid.io/tutorials/deployments/_print/><i class="fa-solid fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#notes>Notes</a></li><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#process>Process</a></li><li><a href=#instance-configuration>Instance Configuration</a></li><li><a href=#management-configuration>Management Configuration</a></li><li><a href=#data-path-configuration>Data Path Configuration</a></li><li><a href=#trustgrid-configuration>Trustgrid Configuration</a></li><li><a href=#creating-the-stack>Creating the Stack</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://docs.trustgrid.io/tutorials/>Guides</a></li><li class=breadcrumb-item><a href=https://docs.trustgrid.io/tutorials/deployments/>Deployments</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://docs.trustgrid.io/tutorials/deployments/deploy-aws-ami/ aria-disabled=true class="btn-link disabled">Deploy a Trustgrid Node AMI in AWS</a></li></ol></nav><div class=td-content><h1>Deploy a Trustgrid Node AMI in AWS</h1><header class=article-meta><div class="taxonomy taxonomy-terms-article taxo-tags"><h5 class=taxonomy-title>Tags:</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>aws</span></a></li></ul></div><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 5 minute read &nbsp;</p></header><p>Standing up a Trustgrid node in AWS is easy using an Amazon AMI. Trustgrid nodes in AWS use two network interfaces - a management and data interface. The management interface communicates with Trustgrid Cloud Management systems. The data interface is used to terminate TLS tunnels from Edge Nodes.</p><h2 id=notes>Notes</h2><ul><li>The cloudformation template below works with an AMI currently published in US-EAST1. Deploying in other regions requires working with Trustgrid Support</li><li>Logs /var/log/syslog, /var/log/secure, and /var/log/trustgrid/tg-default.log to CloudWatch</li><li>Requires VPC and public subnet</li><li>Does not create security groups or roles - those have to be managed separately (more below)</li></ul><div class="alert alert-primary" role=alert><p>If using a burstable performance instance types (T2, T3 and T3a) the following is advised:</p><ul><li><p>Set CPU Credits for all Gateway instances to unlimited to allow CPU to burst in the event there is a spike above the normal threshold. <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/burstable-performance-instances-unlimited-mode.html>Unlimited mode for burstable performance instances - Amazon Elastic Compute Cloud</a></p></li><li><p>Configure monitoring of your CPU Credit Balance to alert if your credits are being consumed or you are being charged for additional CPU usage which might warrant resizing your devices. <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/burstable-performance-instances-monitoring-cpu-credits.html>Monitor your CPU credits - Amazon Elastic Compute Cloud</a></p></li></ul></div><h2 id=prerequisites>Prerequisites</h2><ul><li><p>VPC with public and private subnets - Management NIC goes in the public subnet, Data NIC goes in the private subnet</p><ul><li>Note: If doing a multi-AZ cluster deployment the private subnets need to use the same route table for automated route management to work</li></ul></li><li><p>Security group for management NIC that allows the following traffic:</p><ul><li>Inbound traffic on designated Trustgrid gateway port (typical TCP 8443) for remote nodes. Access to this port can be secured to only allow access from remote nodes if desired. This is only required if deploying a Trustgrid gateway. If the node is acting as an edge then no inbound access is required.</li><li>Outbound traffic to Trustgrid’s control plane IP (TCP 80/443 & 8443 to 35.171.100.16/28 & 34.223.12.192/28)</li><li>Outbound traffic to AWS API (TCP 443) <a href=https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html>https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html</a></li><li>Inbound & Outbound to/from management NIC security group on cluster port (typically TCP port 9000)</li><li>For the initial deployment outbound access for TCP 80/443 should be allowed. Upon successful registration with the Trustgrid Portal this can be removed.</li></ul></li><li><p>IAM role for the instance with policies allowing publishing to Cloudwatch logs and changes to the routing table of the data NIC - See attached doc</p></li><li><p>All Interfaces on the Trustgrid Gateway should have source / destination check disabled in AWS</p></li><li><p>Security group for data NIC - No configuration for now</p></li><li><p>An IP in the private subnet that will be used by the data NIC</p></li><li><p>An SSH keypair that can be used to SSH to the instance if necessary</p></li><li><p>VPC must have unallocated public IP that will be claimed during provisioning</p></li></ul><h2 id=process>Process</h2><ol><li><p>Create a new Node. When complete the Node license will copy to clipboard.</p><ul><li>Note: The node will not be visible in the portal until the registration process is complete.</li><li>Download the license to local storage in case the clipboard is cleared. You cannot reissue a license without recreating the node.</li></ul></li><li><p>Click this link to start the AMI provisioning process. <a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://s3.amazonaws.com/tg-dev-public/cf-trustgrid-node.json">https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://s3.amazonaws.com/tg-dev-public/cf-trustgrid-node.json</a></p></li><li><p>Fill out the fields in the CloudFormation form</p></li></ol><h2 id=instance-configuration>Instance Configuration</h2><tr><th>Stack Name</th><td>Unique name to describe this deployment</td></tr><tr><th>Instance Type</th><td>Set the instance type of the EC2 instance to deploy (bigger instances cost more)</td></tr><tr><th>Host IAM Role</th><td><p>An EC2 associated role that allows creating and writing to CloudWatch logs. Only the role name itself is required.</p><p>The role needs these IAM privileges: <code>logs:CreateLogGroup</code>, <code>logs:CreateLogStream</code>, <code>logs:PutLogEvents</code>, <code>logs:DescribeLogStreams</code> on resource <code>arn:aws:logs:*:*:*</code></p><p>Cloudwatch logs policy</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;Version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2012-10-17&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;Statement&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;Effect&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Allow&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;Action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;logs:CreateLogGroup&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;logs:CreateLogStream&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;logs:PutLogEvents&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;Resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>If EC2 Nodes will be clustered (Layer 3) the IAM role needs <code>ec2:DescribeRouteTables</code> for any resource and <code>ec2:CreateRoute</code> & <code>ec2:DeleteRoute</code> on the route table</p><p>Route Table Policy</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Effect&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Allow&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ec2:DescribeRouteTables&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;*&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Effect&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Allow&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>		<span style=color:#4e9a06>&#34;ec2:CreateRoute&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>		<span style=color:#4e9a06>&#34;ec2:DeleteRoute&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;arn:aws:ec2:us-east-1:079972220921:route-table/rtb-f428d58b&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>NOTE</strong>: Set the Resource field to the ARN of the Routing Table associated with the data NICs of the instance.</p><p><strong>CloudWatch Note</strong>: We will create log groups named /trustgrid/var/log/syslog and /trustgrid/var/log/trustgrid/tg-default.log.</p></td></tr><tr><th>SSH Keypair</th><td><p>SSH keypair to SSH to the instance as ubuntu user if necessary</p><p><strong>NOTE</strong>: SSH access requires a security group change allowing access. We strongly recommend that SSH is not allowed from anywhere (0.0.0.0/0).</p></td></tr><h2 id=management-configuration>Management Configuration</h2><tr><th>Security Group</th><td>Needs to allow outbound traffic to other gateways and our public IP range, at a minimum. If it&rsquo;s a gateway node, needs to allow inbound access on desired gateway port.</td></tr><tr><th>Subnet</th><td>The VPC subnet to put the EC2 instance in. This needs to be a subnet with public IP enables (the instance will automatically claim one; the Auto-Assign Public IP does not need to be enabled)</td></tr><h2 id=data-path-configuration>Data Path Configuration</h2><tr><th>Security Group</th><td>The security group for the data path - needs to allow outbound communication to other gateways, and inbound communication on its gateway port</td></tr><tr><th>Subnet</th><td>The VPC subnet to put the data interface in - if it&rsquo;s a cloud-accessible gateway, should be a public subnet, if it&rsquo;s only for internal AWS traffic, can be a private subnet. Will need outbound access either through IGW or NAT GW.</td></tr><tr><th>Data IP</th><td>The private IP for the data path - must belong to the subnet</td></tr><h2 id=trustgrid-configuration>Trustgrid Configuration</h2><tr><th>Security Group</th><td><p>Copy/paste the license from the portal.</p><p>Note: It is critical that you copy/paste the license correctly.</p></td></tr><div class="alert alert-primary" role=alert>If you are not a direct Trustgrid customer please work with your vendor to get these licenses generated and sent to you.</div><h2 id=creating-the-stack>Creating the Stack</h2><ol><li>Create the stack. Check the box acknowleding that AWS CloudFormation might create IAM resources. This is required because we create an instance profile for the to-be-run EC2 instance.</li><li>When the node appears in the Portal, activate it.</li><li>In the EC2 console, reboot the node (it will be named trustgrid-node)</li><li>You can now manage the node as you would any other in the Portal UI.</li></ol><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof ga!="function")return;const t={command:"send",hitType:"event",category:"Helpful",action:"click",label:window.location.pathname,value:e};ga(t.command,t.hitType,t.category,t.action,t.label,t.value)};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(1)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified February 14, 2023: <a href=https://github.com/trustgrid/docs/commit/4181edcae9859b37574d3af8c64e722be3ca8063>fix headers to be different sizes and change field-def to field (#182) (4181edca)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel=noopener href=https://www.linkedin.com/company/trustgrid/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/trustgrid aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Trustgrid All Rights Reserved</small>
<small class=ml-1><a href=https://trustgrid.io target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=/js/main.min.f1a20e761a85478d0ce3298a01e295324be8858ef8f2d2baac6737980799b320.js integrity="sha256-8aIOdhqFR40M4ymKAeKVMkvohY748tK6rGc3mAeZsyA=" crossorigin=anonymous></script>
<script src=/js/prism.js></script>
<script src=/js/tabpane-persist.js></script></body></html>