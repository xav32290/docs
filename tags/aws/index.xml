<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>– aws</title><link>https://trustgrid.github.io/docs/tags/aws/</link><description>Recent content in aws on</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://trustgrid.github.io/docs/tags/aws/index.xml" rel="self" type="application/rss+xml"/><item><title>Tutorials: Configure HA Trustgrid Gateway Cluster in AWS</title><link>https://trustgrid.github.io/docs/tutorials/deployments/configure-ha-gateway-cluster-in-aws/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://trustgrid.github.io/docs/tutorials/deployments/configure-ha-gateway-cluster-in-aws/</guid><description>
&lt;ol>
&lt;li>
&lt;p>Deploy a pair of Trustgrid gateways. Deployment guide includes an example Cloud Formation template that can be used directly or customized for your environment or converted to Terraform if preferred. Gateways can be deployed in the same availability zone or different ones to provide greater redundancy across AWS. &lt;a href="https://trustgrid.github.io/docs/tutorials/deployments/deploy-aws-ami/">Deploy a Trustgrid Node AMI in AWS&lt;/a>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Under networking &amp;gt; clusters create a cluster using a descriptive and unique name as seen below.
&lt;img src="add-cluster.png" alt="img">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Select the cluster that was created and add both gateways to it using the actions drop down button as seen below.
&lt;img src="add-node.png" alt="img">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Configure the cluster heartbeat on each individual gateway node. This is located under system &amp;gt; cluster. The host should be the gateway interface on which you want to configure the heartbeat. This can be either the WAN facing or LAN facing interface. You can see what IP is configured from the node page under interfaces. The port defaults to TCP 9000 but can be any unused TCP port if desired. Security groups for both gateways will need to allow this communication in both directions. Both gateways send a heartbeat to each other on the configured IP and Port to determine if the other member is healthy. If the secondary is not able to get a response from the primary then it will become the active member of the cluster. Once this has been configured both nodes should show as green and healthy in the cluster as seen below.
&lt;img src="cluster-status.png" alt="img">
&lt;img src="nodes-list.png" alt="img">&lt;/p>
&lt;div class="alert alert-primary" role="alert">
If deploying gateways in different availability zones then LAN interface routes will need to be added to the cluster for both gateway LAN subnets as seen below. This is to ensure the heartbeat communication is routed over the correct interface instead of going out the WAN interface.
&lt;/div>
&lt;p>&lt;img src="interfaces.png" alt="img">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Under the cluster &amp;gt; interfaces &amp;gt; eth1 LAN &amp;gt; AWS Route Table Entries add the appropriate CIDR for the edge IP space. This should be the subnet that includes all virtual network IP space configured for edge node sites. For example if you have 100 different edge node sites carved out of 172.16.0.0/16 then you would just add this one CIDR. Once this has been added the route should be created in the routing table that is associated to the gateways LAN interface pointing to the ENI of the active member of the cluster.&lt;/p>
&lt;p>There is an IAM profile that should have been associated to each gateway outlined in the deployment guide providing them permissions to manage the routes defined in the AWS Route Table Entries. When a failover event occurs an API Call is made to update the route to point to the ENI of the active member of the cluster.&lt;/p>
&lt;p>This concludes the cluster configuration specifics for AWS deployment. Appropriate VPN configuration will need to be applied in order for traffic to pass end to end between the gateways and edge node sites.&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>Tutorials: Deploy a Trustgrid Node AMI in AWS</title><link>https://trustgrid.github.io/docs/tutorials/deployments/deploy-aws-ami/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://trustgrid.github.io/docs/tutorials/deployments/deploy-aws-ami/</guid><description>
&lt;p>Standing up a Trustgrid node in AWS is easy using an Amazon AMI. Trustgrid nodes in AWS use two network interfaces - a management and data interface. The management interface communicates with Trustgrid Cloud Management systems. The data interface is used to terminate TLS tunnels from Edge Nodes.&lt;/p>
&lt;h2 id="notes">Notes&lt;/h2>
&lt;ul>
&lt;li>The cloudformation template below works with an AMI currently published in US-EAST1. Deploying in other regions requires working with Trustgrid Support&lt;/li>
&lt;li>Logs /var/log/syslog, /var/log/secure, and /var/log/trustgrid/tg-default.log to CloudWatch&lt;/li>
&lt;li>Requires VPC and public subnet&lt;/li>
&lt;li>Does not create security groups or roles - those have to be managed separately (more below)&lt;/li>
&lt;/ul>
&lt;div class="alert alert-primary" role="alert">
&lt;p>If using a burstable performance instance types (T2, T3 and T3a) the following is advised:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Set CPU Credits for all Gateway instances to unlimited to allow CPU to burst in the event there is a spike above the normal threshold. &lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/burstable-performance-instances-unlimited-mode.html">Unlimited mode for burstable performance instances - Amazon Elastic Compute Cloud&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Configure monitoring of your CPU Credit Balance to alert if your credits are being consumed or you are being charged for additional CPU usage which might warrant resizing your devices. &lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/burstable-performance-instances-monitoring-cpu-credits.html">Monitor your CPU credits - Amazon Elastic Compute Cloud&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/div>
&lt;h2 id="prerequisites">Prerequisites&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>VPC with public and private subnets - Management NIC goes in the public subnet, Data NIC goes in the private subnet&lt;/p>
&lt;ul>
&lt;li>Note: If doing a multi-AZ cluster deployment the private subnets need to use the same route table for automated route management to work&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Security group for management NIC that allows the following traffic:&lt;/p>
&lt;ul>
&lt;li>Inbound traffic on designated Trustgrid gateway port (typical TCP 8443) for remote nodes. Access to this port can be secured to only allow access from remote nodes if desired. This is only required if deploying a Trustgrid gateway. If the node is acting as an edge then no inbound access is required.&lt;/li>
&lt;li>Outbound traffic to Trustgrid’s control plane IP (TCP 80/443 &amp;amp; 8443 to 35.171.100.16/28 &amp;amp; 34.223.12.192/28)&lt;/li>
&lt;li>Outbound traffic to AWS API (TCP 443) &lt;a href="https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html">https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html&lt;/a>&lt;/li>
&lt;li>Inbound &amp;amp; Outbound to/from management NIC security group on cluster port (typically TCP port 9000)&lt;/li>
&lt;li>For the initial deployment outbound access for TCP 80/443 should be allowed. Upon successful registration with the Trustgrid Portal this can be removed.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>IAM role for the instance with policies allowing publishing to Cloudwatch logs and changes to the routing table of the data NIC - See attached doc&lt;/p>
&lt;/li>
&lt;li>
&lt;p>All Interfaces on the Trustgrid Gateway should have source / destination check disabled in AWS&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Security group for data NIC - No configuration for now&lt;/p>
&lt;/li>
&lt;li>
&lt;p>An IP in the private subnet that will be used by the data NIC&lt;/p>
&lt;/li>
&lt;li>
&lt;p>An SSH keypair that can be used to SSH to the instance if necessary&lt;/p>
&lt;/li>
&lt;li>
&lt;p>VPC must have unallocated public IP that will be claimed during provisioning&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="process">Process&lt;/h2>
&lt;ol>
&lt;li>
&lt;p>Create a new Node. When complete the Node license will copy to clipboard.&lt;/p>
&lt;ul>
&lt;li>Note: The node will not be visible in the portal until the registration process is complete.&lt;/li>
&lt;li>Download the license to local storage in case the clipboard is cleared. You cannot reissue a license without recreating the node.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Click this link to start the AMI provisioning process. &lt;a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://s3.amazonaws.com/tg-dev-public/cf-trustgrid-node.json">https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://s3.amazonaws.com/tg-dev-public/cf-trustgrid-node.json&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Fill out the fields in the CloudFormation form&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="instance-configuration">Instance Configuration&lt;/h2>
&lt;tr>
&lt;th>Stack Name&lt;/th>
&lt;td>Unique name to describe this deployment&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>Instance Type&lt;/th>
&lt;td>Set the instance type of the EC2 instance to deploy (bigger instances cost more)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>Host IAM Role&lt;/th>
&lt;td>&lt;p>An EC2 associated role that allows creating and writing to CloudWatch logs. Only the role name itself is required.&lt;/p>
&lt;p>The role needs these IAM privileges: &lt;code>logs:CreateLogGroup&lt;/code>, &lt;code>logs:CreateLogStream&lt;/code>, &lt;code>logs:PutLogEvents&lt;/code>, &lt;code>logs:DescribeLogStreams&lt;/code> on resource &lt;code>arn:aws:logs:*:*:*&lt;/code>&lt;/p>
&lt;p>Cloudwatch logs policy&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Version&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;2012-10-17&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Statement&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Action&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;logs:CreateLogGroup&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;logs:CreateLogStream&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;logs:PutLogEvents&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;*&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>If EC2 Nodes will be clustered (Layer 3) the IAM role needs &lt;code>ec2:DescribeRouteTables&lt;/code> for any resource and &lt;code>ec2:CreateRoute&lt;/code> &amp;amp; &lt;code>ec2:DeleteRoute&lt;/code> on the route table&lt;/p>
&lt;p>Route Table Policy&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-json" data-lang="json">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Action&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;ec2:DescribeRouteTables&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;*&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#a40000">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Effect&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Allow&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Action&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;ec2:CreateRoute&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;ec2:DeleteRoute&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;Resource&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;arn:aws:ec2:us-east-1:079972220921:route-table/rtb-f428d58b&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>NOTE&lt;/strong>: Set the Resource field to the ARN of the Routing Table associated with the data NICs of the instance.&lt;/p>
&lt;p>&lt;strong>CloudWatch Note&lt;/strong>: We will create log groups named /trustgrid/var/log/syslog and /trustgrid/var/log/trustgrid/tg-default.log.&lt;/p>
&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>SSH Keypair&lt;/th>
&lt;td>&lt;p>SSH keypair to SSH to the instance as ubuntu user if necessary&lt;/p>
&lt;p>&lt;strong>NOTE&lt;/strong>: SSH access requires a security group change allowing access. We strongly recommend that SSH is not allowed from anywhere (0.0.0.0/0).&lt;/p>
&lt;/td>
&lt;/tr>
&lt;h2 id="management-configuration">Management Configuration&lt;/h2>
&lt;tr>
&lt;th>Security Group&lt;/th>
&lt;td>Needs to allow outbound traffic to other gateways and our public IP range, at a minimum. If it&amp;rsquo;s a gateway node, needs to allow inbound access on desired gateway port.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>Subnet&lt;/th>
&lt;td>The VPC subnet to put the EC2 instance in. This needs to be a subnet with public IP enables (the instance will automatically claim one; the Auto-Assign Public IP does not need to be enabled)&lt;/td>
&lt;/tr>
&lt;h2 id="data-path-configuration">Data Path Configuration&lt;/h2>
&lt;tr>
&lt;th>Security Group&lt;/th>
&lt;td>The security group for the data path - needs to allow outbound communication to other gateways, and inbound communication on its gateway port&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>Subnet&lt;/th>
&lt;td>The VPC subnet to put the data interface in - if it&amp;rsquo;s a cloud-accessible gateway, should be a public subnet, if it&amp;rsquo;s only for internal AWS traffic, can be a private subnet. Will need outbound access either through IGW or NAT GW.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;th>Data IP&lt;/th>
&lt;td>The private IP for the data path - must belong to the subnet&lt;/td>
&lt;/tr>
&lt;h2 id="trustgrid-configuration">Trustgrid Configuration&lt;/h2>
&lt;tr>
&lt;th>Security Group&lt;/th>
&lt;td>&lt;p>Copy/paste the license from the portal.&lt;/p>
&lt;p>Note: It is critical that you copy/paste the license correctly.&lt;/p>
&lt;/td>
&lt;/tr>
&lt;div class="alert alert-primary" role="alert">
If you are not a direct Trustgrid customer please work with your vendor to get these licenses generated and sent to you.
&lt;/div>
&lt;h2 id="creating-the-stack">Creating the Stack&lt;/h2>
&lt;ol>
&lt;li>Create the stack. Check the box acknowleding that AWS CloudFormation might create IAM resources. This is required because we create an instance profile for the to-be-run EC2 instance.&lt;/li>
&lt;li>When the node appears in the Portal, activate it.&lt;/li>
&lt;li>In the EC2 console, reboot the node (it will be named trustgrid-node)&lt;/li>
&lt;li>You can now manage the node as you would any other in the Portal UI.&lt;/li>
&lt;/ol></description></item></channel></rss>