<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://trustgrid.github.io/docs/docs/clusters/><link rel=alternate type=application/rss+xml href=https://trustgrid.github.io/docs/docs/clusters/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/docs/favicons/favicon.ico><link rel=apple-touch-icon href=/docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/docs/favicons/android-192x192.png sizes=192x192><title>Clusters |</title><meta name=description content="Trustgrid Network Device and API documentation"><meta property="og:title" content="Clusters"><meta property="og:description" content="Trustgrid Network Device and API documentation"><meta property="og:type" content="website"><meta property="og:url" content="https://trustgrid.github.io/docs/docs/clusters/"><meta itemprop=name content="Clusters"><meta itemprop=description content="Trustgrid Network Device and API documentation"><meta name=twitter:card content="summary"><meta name=twitter:title content="Clusters"><meta name=twitter:description content="Trustgrid Network Device and API documentation"><link rel=preload href=/docs/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css as=style><link href=/docs/scss/main.min.cd8ef62840094746f6b6a72f022aa002a82f35bfec4c2eff8212bf451c91cd1b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/docs/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99793053-3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-99793053-3")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/docs/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 469 106"><defs><style>.cls-1{fill:#6b6b6b}.cls-2{fill:#226ce0}</style></defs><title>Trustgrid-Logo-Grey</title><path class="cls-1" d="M.35 28.58H29.26V-.33H.35zM7.13 6.45H22.47V21.8H7.13z"/><path class="cls-1" d="M67.82-.33H38.9V28.58H67.82zM61 21.8H45.68V6.45H61z"/><path class="cls-1" d="M.35 67.13H29.26V38.22H.35zM7.13 45H22.47V60.35H7.13z"/><path class="cls-1" d="M106.36 38.22H77.45v12.3H67.82V41.27L85.26 23.83l-3.06-3L64.76 38.22H38.9V67.13H67.82V54.83h9.63v12.3h12.3V80.39h4.31V67.13h12.3zM61 60.35H45.68V45H61zm38.55.0H84.23V45H99.58z"/><path class="cls-1" d="M.35 105.69H29.26V76.77H.35zM7.13 83.55H22.47V98.9H7.13z"/><path class="cls-1" d="M38.9 105.69H67.82V76.77H38.9zm6.78-22.14H61V98.9H45.68z"/><path class="cls-2" d="M153.94 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22H140V38.78h13.2v5.78H140V67q0 3.59 1.31 5.13a4.8 4.8.0 003.91 1.55 13.59 13.59.0 006.67-2z"/><path class="cls-2" d="M176.74 39.56A18 18 0 01186 37.07V44.4q-6.58-.24-10.66 3.42a14.51 14.51.0 00-4.64 9.85V80.39h-7.57V37.32h7.57V46.6a15.52 15.52.0 016-7"/><path class="cls-2" d="M232.34 37.32V80.39h-7.65V71.27q-4.23 9.2-16 9.36-7.48.0-11.72-4.44t-4.24-12.25V37.32h7.66V61.9q0 5.46 3 8.51a10.87 10.87.0 008.18 3.06 12.11 12.11.0 009.57-4.28 16 16 0 003.54-10.7V37.32z"/><path class="cls-2" d="M260.47 44.24a21.21 21.21.0 00-6.15-1 10.48 10.48.0 00-5.49 1.26 4.21 4.21.0 00-2.08 3.87 4.3 4.3.0 002.32 4 34.68 34.68.0 007 2.73 54.86 54.86.0 017.33 2.6 13 13 0 014.85 3.83 10.51 10.51.0 012 6.67 10.58 10.58.0 01-4.6 9.29 19.65 19.65.0 01-11.44 3.17 28.35 28.35.0 01-9.32-1.55 21.07 21.07.0 01-7.61-4.39l2.85-5.54a20.07 20.07.0 006.63 3.91 22 22 0 007.69 1.47 11.45 11.45.0 006-1.39 4.61 4.61.0 002.28-4.23 4.82 4.82.0 00-2.4-4.4 32.85 32.85.0 00-7.29-2.93 48.4 48.4.0 01-7-2.48 12.43 12.43.0 01-4.64-3.71A10 10 0 01239.5 49q0-6 4.4-9a19.07 19.07.0 0111-3 27.13 27.13.0 017.69 1.1 23 23 0 016.56 3l-2.77 5.78a26 26 0 00-5.9-2.6"/><path class="cls-2" d="M303.42 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22h7.65V38.78h13.19v5.78H289.49V67c0 2.39.44 4.1 1.3 5.13a4.81 4.81.0 003.91 1.55 13.62 13.62.0 006.68-2z"/><path class="cls-1" d="M352.92 36.34V76.48a19.18 19.18.0 01-3 10.71 19.61 19.61.0 01-8.43 7.08A29.79 29.79.0 01329 96.75a36.74 36.74.0 01-10.66-1.54 34 34 0 01-9-4.16l5.05-10a25.68 25.68.0 006.51 3.17 22.5 22.5.0 007.08 1.14 12.11 12.11.0 007.74-2.27 7.52 7.52.0 002.85-6.2V72.16Q334.12 77.95 326 78a17.69 17.69.0 01-16.41-10.14 24.71 24.71.0 01-2.4-11.12 24.42 24.42.0 012.32-10.91A17.35 17.35.0 01316 38.46a17.92 17.92.0 019.61-2.61A17.42 17.42.0 01333 37.36a14.36 14.36.0 015.5 4.35V36.34zM336.07 64.51a11 11 0 002.44-7.41 11.16 11.16.0 00-2.44-7.49 8.69 8.69.0 00-12.91.0 11 11 0 00-2.48 7.45 10.85 10.85.0 002.48 7.41 8.18 8.18.0 006.47 2.85 8.08 8.08.0 006.44-2.85"/><path class="cls-1" d="M383.9 37.8a16.63 16.63.0 018.26-2V49c-.49.0-1.22-.08-2.2-.08a13.4 13.4.0 00-8.3 2.4A9.18 9.18.0 00378 57.92V80.39H363.5v-44H378v7.33a16 16 0 015.9-5.87"/><path class="cls-1" d="M411.09 18.22a7.55 7.55.0 012.16 5.58 7.59 7.59.0 01-2.16 5.54 8 8 0 01-11 0 7.59 7.59.0 01-2.16-5.54 7.55 7.55.0 012.16-5.58 8.1 8.1.0 0111 0M398.51 36.34h14.41V80.39H398.51z"/><path class="cls-1" d="M468.45 20V80.39H454v-5.7a14.92 14.92.0 01-5.58 4.68A16.94 16.94.0 01440.93 81a20.15 20.15.0 01-10.75-2.85 19.16 19.16.0 01-7.2-8 26.51 26.51.0 01-2.57-11.93 25.77 25.77.0 012.53-11.72A18.6 18.6.0 01430 38.62a20.05 20.05.0 0110.59-2.77 17.24 17.24.0 017.61 1.63A16.19 16.19.0 01454 42.12V20zm-17.1 46.5A11.77 11.77.0 00454 58.57a11.76 11.76.0 00-2.61-8 8.58 8.58.0 00-6.84-3 8.67 8.67.0 00-6.88 3.05A11.69 11.69.0 00435 58.57a11.68 11.68.0 002.64 7.93 8.68 8.68.0 006.88 3.06 8.53 8.53.0 006.84-3.06"/><path class="cls-2" d="M99.58 21.8H84.23V6.46H99.58zM106.36-.33H77.45V28.59h28.91z"/><path class="cls-2" d="M99.58 98.9H84.23V83.55H99.58zm6.78-22.13H77.45v28.92h28.91z"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/getting-started/><span>Getting Started</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/tutorials/><span>Guides</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/help-center/><span>Help Center</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/release-notes/><span>Release Notes</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/docs/offline-search-index.3b0707db3fe2a708b0209a652a39dbdb.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/docs/clusters/>Return to the regular view of this page</a>.</p></div><h1 class=title>Clusters</h1><ul><li>1: <a href=#pg-688ad9c68abbea9606d394d2d4e1b6f8>Cluster Site Health State</a></li></ul><div class=content><div class="pageinfo pageinfo-primary"><p>A cluster is a pair of <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> that share configuration and an active/standby relationship, providing automated high-availability (HA) connectivity.</p></div><p>A cluster is a pair of <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> at a single site that share some configurations and provide automatic failover. An additional IP address is assigned as a Cluster Virtual IP address that can move between the <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> if failover occurs.</p><p>Certain settings such as network services and VPN settings can be configured for the cluster and these settings will override the individual <a href=https://trustgrid.github.io/docs/docs/nodes/>node&rsquo;s</a> configuration.</p><div class="alert alert-primary" role=alert>Formerly the active member was referred to as the “master.” We are in the process moving to the terms active and standby. This documentation will use those terms but elements in the UI may retain the <em>master</em> term.</div><h2 id=requirements>Requirements</h2><ul><li>Nodes in the cluster must be using the same model of appliances</li><li>Nodes must be able to create direct TCP connections with each other</li><li>Nodes should be at the same site or have high-bandwidth, high-reliability, low-latency connections between the devices</li></ul><h2 id=active-member-determination>Active Member Determination</h2><p>The active member of a cluster is determined by the following factors:</p><ul><li>Cluster heartbeat communication</li><li>Cluster mode</li><li>Configured master</li><li>Cluster member health</li></ul><h3 id=cluster-heartbeat-communication>Cluster Heartbeat Communication</h3><p>Cluster members utilize a direct TCP connection to each other to determine if their partner is online and share their health status. Each node will listen on a configured heartbeat IP and port, while at the same time connecting to their partner’s configured heartbeat IP and port.</p><div class="alert alert-primary" role=alert>Local ACLs allow only the partner cluster member to connect to the listening port.</div><p>Heartbeat communication is configured on each node&rsquo;s <a href=https://trustgrid.github.io/docs/docs/nodes/cluster/>cluster</a> page.</p><h3 id=cluster-mode>Cluster Mode</h3><p>A cluster can be configured in two different modes to determine what happens when a failed member returns to healthy status:</p><ul><li>Automatic Failback (Default) - In this mode the member set as the Configured Master (see below) will maintain the active/master role as long as it is online and healthy.</li><li>Manual Failback - In this mode, the active/master role only moves if either the current holder fails or the configured master is changed</li></ul><p><img src=cluster-mode.png alt=img></p><p>Consider a cluster with members named Node1, the configured master, and Node2.</p><table><thead><tr><th>Event</th><th>Automatic Failback - Active Member</th><th>Manual Failback - Active Member</th></tr></thead><tbody><tr><td>Initial State</td><td>Node1</td><td>Node1</td></tr><tr><td>Node1 unhealthy/offline</td><td>Node2</td><td>Node2</td></tr><tr><td>Node1 returns to healthy/online</td><td>Node1</td><td>Node2</td></tr></tbody></table><h3 id=configured-master>Configured Master</h3><p>Each cluster will have one configured or preferred active member. This is reflected in the overview section.</p><p><img src=nodes-list.png alt=img></p><p>A node may be designated as the preferred active member by selecting the node and clicking the &ldquo;Set as Master&rdquo; action</p><p><img src=set-as-master.png alt=img></p><p>The <code>Configured Master</code> field will change immediately, but the <code>Current Master</code> may take a minute to reflect the change as the nodes process the change and notify the control plane.</p><h3 id=cluster-member-health>Cluster Member Health</h3><p>There may be situations where both cluster members are online and can communicate with each other, but external conditions exist that make a node unsuitable to hold the active role. The Trustgrid node service monitors for such conditions and will make a node as unhealthy if one occurs. The node will release the active role and its standby member will take over if it is online and healthy.</p><p>When the condition clears the node will declare itself healthy and inform its partner member. Depending on the cluster mode it may reclaim the active role.</p><h4 id=cluster-member-health-conditions>Cluster Member Health Conditions</h4><ul><li><p>Interface Link (Up/Down) State - Any interface configured with an IP address in the Trustgrid is monitored for a successful connection to another network device</p><ul><li>Example: In a two-interface setup it would be possible for the LAN interface to become unplugged but the node to remain online from the cloud and data plane perspective. However, the lack of LAN connectivity would prevent the node from delivering any Trustgrid services to that network</li><li>Note: If only a single node has an interface configured, such as an alternate MPLS path, Trustgrid support can configure it to be ignored for triggering.</li></ul></li><li><p>Upstream Internet Issues - If a Trustgrid node is unable to build connections to both the Trustgrid control plane AND data plane connections to its gateways the node will be marked as unhealthy. This does require all the connections to be failing before it is triggered</p><ul><li>Example: If an upstream internet provider or device experiences failure the node will not be able to provide any services.</li></ul></li><li><p>Layer 4 (L4 Proxy) Service Health Check - TCP L4 Proxy Services can be configured to regularly perform health checks to confirm a successful connection can be made. If these checks fail 5 times in a row the service will mark the cluster member as unhealthy.</p><ul><li>Example: If each cluster member’s LAN interface is connected to a different switch and one switch fails that member will be unable to connect to any IP:ports dependent on that path.<br><div class="alert alert-warning" role=alert>Use caution before configuring multiple services with health checks. This could create a situation where both nodes declare themselves unhealthy because a single service is failing if the server providing the service goes offline.</div></li></ul></li></ul><h2 id=cluster-member-shared-configuration>Cluster Member Shared Configuration</h2><p>Cluster members can share the configuration for the following services:</p><ul><li>Networking<ul><li>Interfaces<ul><li>Interface routes</li><li>Cluster VIP (supported in on-premise, traditional network environment)</li><li>AWS/Azure/GCP route table entries</li></ul></li><li>VPN</li><li>Tunnels</li><li>VRFs</li><li>ZTNA gateway endpoints</li><li>Layer 4 services and connectors</li></ul></li><li>Compute<ul><li>Container and command definitions</li><li>Resource limits</li></ul></li></ul><h2 id=tags>Tags</h2><p><a href=https://trustgrid.github.io/docs/docs/nodes/tags/>Tags</a> are visible at the bottom of the overview page for the resource.</p><p><img src=cluster-tags.png alt=img></p><h3 id=modifying-tags>Modifying Tags</h3><p>To add a tag:</p><ol><li><p>Click <code>Add Tag</code>.</p></li><li><p>A new row will appear at the bottom of the tags table. There will be a list of existing tag names for your organization. You can filter the list by typing in the field. You can either select an existing tag name, or create a new one by typing it out in full and then selecting <code>New selection: tagName</code>.</p></li></ol><p><img src=new-tag-name.png alt=img></p><ol><li><p>Next move to the values field. As with the name, existing values will be listed. To enter a new value type it in completely.</p></li><li><p>Click <code>Save</code></p></li></ol><p>Tag rows can be edited in-place. Change the name or value, then click <code>Save</code>.</p><p>To remove a tag, click the red X next to the tag name, then click <code>Save</code>.</p><h3 id=applying-a-tag-filter-to-the-clusters-table>Applying a Tag Filter to the Clusters Table</h3><p>The clusters table can also be filtered to only show clusters with a specific tag name:value.</p><ol><li>On the clusters table click <code>Actions</code> and select <code>Add Tag Filter</code> from the drop-down menu.</li></ol><p><img src=add-tag-filter-2.png alt=img></p><ol><li>After clicking <code>Add Tag Filter</code>, select the tag-name field and you will see a list of tag-names available. Select the desired tag.</li></ol><p><img src=pick-tag-filter-name2.png alt=img></p><p>You can also start typing to filter what tag names are shown.</p><ol start=3><li><p>Select the tag value field and you will see a list of available values. Select the desired value.</p></li><li><p>(Optional) Click <code>Add Tag Filter</code> to include an additional filter. Note that the two filters will be applied using AND only clusters with both tag name:value combinations matching will be shown.</p></li><li><p>Click <code>Apply Tag Filter</code> and the table will only show matching clusters.</p></li></ol><p><img src=applied-filters2.png alt=img></p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-688ad9c68abbea9606d394d2d4e1b6f8>1 - Cluster Site Health State</h1><div class="pageinfo pageinfo-primary"><p>A healthy <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> should have two online Trustgrid <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> in a healthy state. The Trustgrid control plane can monitor the member <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> and generate <a href=https://trustgrid.github.io/docs/docs/alarms/events/>events</a> when their state changes such that the health of the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> is impacted.</p></div><h3 id=basics>Basics</h3><div class="alert alert-primary" role=alert><p>These events are based on the information reported by each member node to the control plane. Because of this:</p><ul><li>There can be a delay between a change and the <a href=https://trustgrid.github.io/docs/docs/clusters/>Cluster</a> Site Health events.</li><li>If member <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> have issues preventing control plane connections but not impacting data plane or other services the <a href=https://trustgrid.github.io/docs/docs/alarms/events/>events</a> may not accurately reflect the state of the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a>.</li></ul></div><h3 id=cluster-health-state>Cluster Health State</h3><p>The Trustgrid will now display one of three states in the portal:</p><table><tbody><tr><th>State</th><th>Meaning</th></tr><tr><th>Healthy</th><td>Both members are online with a single member active.</td></tr><tr><th>Unhealthy</th><td><p>There is at least one online and healthy member of the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> with the active role AND one or more of these conditions is true:</p><ul><li>One of the <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> members is offline, unhealthy or disabled</li><li>There are <strong>two</strong> <a href=https://trustgrid.github.io/docs/docs/clusters/>cluster</a> members with the active role</li></ul></td></tr><tr><th>Offline</th><td><p>Both <a href=https://trustgrid.github.io/docs/docs/nodes/>nodes</a> are offline, unhealthy or disabled.</p></td></tr></tbody></table></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel=noopener href=https://www.linkedin.com/company/trustgrid/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/trustgrid aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Trustgrid All Rights Reserved</small>
<small class=ml-1><a href=https://trustgrid.io target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=/docs/js/main.min.f1a20e761a85478d0ce3298a01e295324be8858ef8f2d2baac6737980799b320.js integrity="sha256-8aIOdhqFR40M4ymKAeKVMkvohY748tK6rGc3mAeZsyA=" crossorigin=anonymous></script>
<script src=/docs/js/prism.js></script>
<script src=/docs/js/tabpane-persist.js></script></body></html>